<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Simulador de Reestructuración de Deuda - DMD Asesores</title>
  
  <!-- CHART.JS -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Biblioteca MSAL de Microsoft para autenticación -->
  <script src="https://alcdn.msauth.net/browser/2.31.0/js/msal-browser.min.js"></script>
  
  <!-- Hoja de estilos externa -->
  <link rel="stylesheet" href="css/styles.css" />
</head>
<body>
  <!-- ====================== CONTENEDOR PRINCIPAL ====================== -->
  <div class="contenedor-simulador">
    <div class="header-simulador">
      <!-- Reemplaza el src base64 por tu logo o imagen real -->
      <img src="data:image/png;base64,..." alt="Logo DMD" class="logo apple-logo" />
      <h1>DMD - Simulador de Reestructuración</h1>
    </div>
    
    <!-- Botón para mostrar/ocultar la gestión de entidades -->
    <div class="toggle-container">
      <button class="btn btn-secundario" id="btnToggleEntidades" aria-label="Mostrar/Ocultar Entidades">
        Mostrar Administrar Entidades
      </button>
    </div>
    
    <!-- Sección de Administrar Entidades (oculta por defecto) -->
    <div class="gestor-entidades" id="entidadesContainer" style="display: none;">
      <h2>Administrar Entidades</h2>
      <div class="campo">
        <label for="nuevaEntidad">Nombre de nueva entidad:</label>
        <input type="text" id="nuevaEntidad" placeholder="Ej: Banco XYZ" />
      </div>
      <button class="btn btn-primario" id="btnAgregarEntidad">Agregar entidad</button>
      <ul id="listaEntidades"></ul>
    </div>
    
    <!-- Campo para el nombre del deudor/cliente -->
    <div class="campo">
      <label for="nombreDeudor">Nombre del cliente:</label>
      <input type="text" id="nombreDeudor" placeholder="Ej: Juan Pérez" />
    </div>
    
    <!-- Tabla para agregar las deudas -->
    <table>
      <thead>
        <tr>
          <th>N° Contrato</th>
          <th>Tipo Producto</th>
          <th>Entidad</th>
          <th>Importe de deuda (€)</th>
          <th>% Descuento</th>
          <th>Importe con descuento (€)</th>
          <th>Eliminar</th>
        </tr>
      </thead>
      <tbody id="tablaDeudas">
        <!-- Filas generadas dinámicamente -->
      </tbody>
    </table>

    <!-- Botones principales del simulador -->
    <button class="btn btn-primario" id="btnAgregarFila" aria-label="Añadir fila">+ Añadir fila</button>
    <button class="btn btn-primario" id="btnCalcular" aria-label="Calcular resultados">Calcular</button>
    <button class="btn btn-secundario" id="btnReAnalizar" aria-label="Re-Analizar">Re-Analizar</button>
    
    <!-- Campo para especificar el número de cuotas -->
    <div class="campo">
      <label for="numCuotas">Nº de cuotas:</label>
      <input type="number" id="numCuotas" placeholder="12" value="12" min="1" />
    </div>
    
    <!-- Sección de resultados (oculta inicialmente) -->
    <div class="resultado-final" id="resultadoFinal" style="display: none;">
      <p id="resultadoTotalAPagar"><strong>Total a Pagar:</strong> €0.00</p>
    </div>
    
    <!-- Botón para mostrar historial de simulaciones -->
    <button class="btn btn-secundario" id="btnMostrarHistorial" aria-label="Mostrar historial">Mostrar Historial</button>
  </div>

  <!-- ====================== CONTENEDOR PLAN DE LIQUIDACIÓN ====================== -->
  <div class="plan-container-outer" id="planContainerOuter">
    <!-- Botones adicionales dentro del plan -->
    <button class="btn-descargar-plan" id="btnDescargarPlan" aria-label="Descargar PDF">Descargar PDF</button>
    <button class="btn btn-primario" id="btnContratar" aria-label="Contratar Plan">Contratar Plan</button>
    
    <!-- Contenido del plan en sí -->
    <div id="plan-de-liquidacion">
      <img src="data:image/png;base64,..." alt="Logo DMD" class="logo apple-logo" style="margin: 0 auto 20px auto;" />
      <div class="header">DMD asesores</div>
      
      <div class="info-container">
        <div class="info-box">
          <p><strong>Nombre:</strong> <span id="plan-nombre-deudor">--</span></p>
          <p><strong>Número de deudas:</strong> <span id="plan-num-deudas">0</span></p>
          <p><strong>Deuda total:</strong> <span id="plan-deuda-total">€0.00</span></p>
        </div>
        <div class="info-box">
          <p><strong>Caso:</strong> <span id="plan-folio">--</span></p>
          <p><strong>Fecha:</strong> <span id="plan-fecha">--</span></p>
          <p><strong>Fecha de vigencia:</strong> 3 días hábiles</p>
        </div>
      </div>
      
      <div class="plan-container">
        <div class="plan-left">
          <!-- Gráfico con Chart.js -->
          <div class="chart">
            <canvas id="myChart"></canvas>
          </div>
          <div class="values">
            <p>Lo que debes: <span id="plan-lo-que-debes">€0.00</span></p>
            <p>Lo que pagarías: <span id="plan-lo-que-pagarias">€0.00</span></p>
          </div>
          <div class="ahorro">
            Te ahorrarás <span id="plan-ahorro">€0.00</span>
          </div>
        </div>
        <div class="plan-right">
          <!-- Tarjetas con información resumida -->
          <div class="plan-card">
            <p>La cuota mensual</p>
            <h4 id="plan-cuota-mensual">€0.00</h4>
          </div>
          <div class="plan-card">
            <p>El descuento total</p>
            <h4 id="plan-descuento-total">0%</h4>
          </div>
          <div class="plan-card">
            <p>La duración</p>
            <h4 id="plan-duracion">0 meses</h4>
          </div>
        </div>
      </div>
      
      <!-- Tabla de detalle de deudas en el plan -->
      <div class="tabla-deudas">
        <h2>Detalle de deudas</h2>
        <table>
          <thead>
            <tr>
              <th>A quién le debes</th>
              <th>Lo que debes</th>
              <th>Lo que pagarías</th>
            </tr>
          </thead>
          <tbody id="plan-tabla-body">
            <!-- Se llenará dinámicamente -->
          </tbody>
        </table>
      </div>
      
      <!-- Disclaimer / Pie de página -->
      <div class="disclaimer">
        <p>
          La reducción de la deuda con las entidades financieras es aproximada y se calcula conforme a nuestra experiencia, considerando la naturaleza de la entidad (regulada o no regulada), el tipo de crédito y las garantías asociadas.
        </p>
        <p>
          Se aclara expresamente que: Cualquier variación en la Deuda Total Inicial (DTI) declarada por el cliente estará sujeta a la validación y criterio discrecional de la entidad acreedora correspondiente. De existir una discrepancia sustancial, podría implicar la modificación del Plan de Liquidación propuesto, previa notificación al cliente.
        </p>
        <p>
          Los datos contenidos en este documento tienen carácter informativo y reflejan una proyección estimada, sujeta a cambios derivados de circunstancias externas o actualizaciones contractuales. Todos los montos indicados incluyen IVA.
        </p>
        <p>
          Comisión Administrativa Mensual: El plan incluye una comisión de gestión de DMD, con un monto total de
          <strong>€<span id="plan-comision-gestion">0.00</span></strong>, distribuido en partes iguales a lo largo de los
          <strong><span id="plan-num-cuotas">0</span></strong> meses de vigencia del acuerdo. La primera cuota incluye un cargo único por comisión de apertura al programa, equivalente al monto de un mes de ahorro.
        </p>
        <p>
          Comisión de Éxito: Se aplicará una comisión de <strong>€<span id="plan-comision-exito">0.00</span></strong> que equivale al 25.00% del importe reducido en cada operación de liquidación acordada con las entidades. Este cargo se calculará y facturará tras la confirmación de cada acuerdo de reducción.
        </p>
      </div>
      <div class="footer">
        <div class="asesor-info">
          <p><strong>Asesor:</strong> <span id="plan-asesor">Mailyn Yonari Troches Padilla</span></p>
          <p><strong>Email:</strong> <span id="plan-asesor-email">mailyn.troches@dmdasesores.com</span></p>
          <p>C. de José Bardasano Baos, 9, 3-B, Chamartín, 28016 Madrid</p>
        </div>
      </div>
    </div>
  </div>

  <!-- ====================== HISTORIAL DE SIMULACIONES ====================== -->
  <div class="historial-container" id="historialContainer" style="display: none;">
    <h2>Historial de Simulaciones</h2>
    <table id="tablaHistorial">
      <thead>
        <tr>
          <th>Folio</th>
          <th>Fecha</th>
          <th>Nombre</th>
          <th># Deudas</th>
          <th>Deuda Original</th>
          <th>Deuda Descontada</th>
          <th>Ahorro</th>
          <th>Total a Pagar</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody id="historialBody">
        <!-- Filas dinámicas -->
      </tbody>
    </table>
    <button class="btn btn-secundario" id="btnCerrarHistorial" aria-label="Cerrar historial">
      Cerrar Historial
    </button>
  </div>
  
  <!-- =======================================================
       Librerías para generar PDF (ubicadas en la carpeta .libs)
  ======================================================= -->
  <script src="./.libs/html2canvas.min.js"></script>
  <script src="./.libs/jspdf.umd.min.js"></script>
  <script src="./.libs/html2pdf.bundle.min.js"></script>
  
  <!-- Archivo JavaScript principal -->
  <script src="js/main.js"></script>
</body>
</html>
